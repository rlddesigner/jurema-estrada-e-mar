---
import { getEntryBySlug, getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Seo from '../../components/Seo.astro';

export async function getStaticPaths() {
  const pontos = await getCollection('pontos');
  return pontos.map((ponto) => ({
    params: { slug: ponto.slug },
    props: { ponto }
  }));
}

const { ponto } = Astro.props;
const { Content } = await ponto.render();
const { title, description, image, seo } = ponto.data;

const seoTitle = seo?.title || title;
const seoDescription = seo?.description || description;
const url = `https://juremaestradaemar.netlify.app/pontos/${ponto.slug}`;

// ðŸ”¥ AQUI adiciona para pegar Ãºltimos pontos
const todosPontos = await getCollection('pontos');

const ultimosPontos = todosPontos
  .filter((p) => p.slug !== ponto.slug)
  .sort((a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate))
  .slice(0, 3);
---

<Layout
  title={title}
  description={description}
>

<!-- Adiciona o SEO dentro do Layout, na Ã¡rea do <head> -->
  <head>
    <Seo title={seoTitle} description={seoDescription} url={url} image={image} />
  </head>

  <main class={`pagina-oracao ${post.data.classe}`}>
    {image && <img src={image} alt={title} class="capa-oracao" />}
    <h1>{title}</h1>

    <article class="conteudo-oracao">
      <Content />
    </article>

<!-- ðŸ”¥ AQUI vocÃª coloca os Ãšltimos Pontos -->
  {ultimosPontos.length > 0 && (
    <section class="ultimos-pontos">
      <h2>ðŸŽ¶ Ãšltimos Pontos Cantados</h2>
      <div class="grade-pontos">
        {ultimosPontos.map(({ data }) => (
          <a href={`/pontos/${data.slug}`} class="card-ponto">
            {data.image && <img src={data.image} alt={data.title} />}
            <h3>{data.title}</h3>
          </a>
        ))}
      </div>
    </section>
  )}
  </main>
</Layout>
